pkgname='ntfsplus'
pkgver=2025.10.24.r8.6ce7d0eb
pkgrel=1
pkgdesc='A new NTFS driver for Linux promised to be better than NTFS3'
arch=('x86_64')
url='https://github.com/shadichy/ntfsplus-dkms'
license=('GPL')
makedepends=('linux-zen-headers' "ntfsplus-dkms-git=$pkgver")

build() {
  _kernver="$(</usr/src/linux-zen/version)"

  fakeroot dkms build --dkmstree "$srcdir" -m ntfsplus/${pkgver} -k ${_kernver}
}

package(){
  depends=('linux-zen')

  _kernver="$(</usr/src/linux-zen/version)"

  install -Dt "$pkgdir/usr/lib/modules/$_kernver/extramodules" -m0644 \
    ntfsplus/${pkgver}/${_kernver}/${CARCH}/module/*.ko*

  # compress each module individually
  find "${pkgdir}" -name '*.ko' -exec zstd --rm -19 {} +
}
