pkgname=qtcreator-spellchecker-plugin
pkgver=2.0.12
_commit=b9d5182
pkgrel=1
pkgdesc="Spell Checker plugin for the Qt Creator IDE"
groups=('qt' 'qt6')
arch=('i686' 'x86_64')
url="https://github.com/CJCombrink/SpellChecker-Plugin"
license=('GPL3')
depends=('qtcreator' 'hunspell')
makedepends=('git' 'qtcreator-src')
source=("$pkgname"::git+https://github.com/CJCombrink/SpellChecker-Plugin.git)
sha256sums=('SKIP')

build() {
    mkdir -p "${srcdir}/${pkgname}/build/lib/qtcreator/plugins/"
    ln -s /usr/lib/qtcreator/libAggregation.so.6 "${srcdir}/${pkgname}/build/lib/qtcreator/plugins/libAggregation.so"
    ln -s /usr/lib/qtcreator/libQtcSsh.so.6 "${srcdir}/${pkgname}/build/lib/qtcreator/plugins/libQtcSsh.so"
    ln -s /usr/lib/qtcreator/libCPlusPlus.so.6 "${srcdir}/${pkgname}/build/lib/qtcreator/plugins/libCPlusPlus.so"
    ln -s /usr/lib/qtcreator/libClangSupport.so.6 "${srcdir}/${pkgname}/build/lib/qtcreator/plugins/libClangsupport.so"
    ln -s /usr/lib/qtcreator/libExtensionSystem.so.6 "${srcdir}/${pkgname}/build/lib/qtcreator/plugins/libExtensionSystem.so"
    ln -s /usr/lib/qtcreator/libUtils.so.6 "${srcdir}/${pkgname}/build/lib/qtcreator/plugins/libUtils.so"
    ln -s /usr/lib/qtcreator/libSqlite.so.6 "${srcdir}/${pkgname}/build/lib/qtcreator/plugins/libSqlite.so"
    ln -s /usr/lib/qtcreator/libKSyntaxHighlighting.so.6 "${srcdir}/${pkgname}/build/lib/qtcreator/plugins/libKSyntaxHighlighting.so"

    cd "${srcdir}/${pkgname}"
    git checkout ${_commit}
    
    QTC_SOURCE=/usr/src/qtcreator QTC_BUILD=build qmake6 \
        "LIBS+=-L/usr/lib/qtcreator -L/usr/lib/qtcreator/plugins" \
        "KSYNTAXHIGHLIGHTING_LIB_DIR=/usr/lib" "KSYNTAXHIGHLIGHTING_INCLUDE_DIR=/usr/include/KF5/KSyntaxHighlighting"

    make
}

package() {
    cd "${srcdir}/${pkgname}"

    make INSTALL_ROOT="${pkgdir}/usr" install
}
