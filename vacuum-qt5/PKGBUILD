# Maintainer: KsenZ <aksenzov@gmail.com>

pkgname=vacuum-im-git
pkgver=20180105
pkgrel=1
pkgdesc="Full-featured crossplatform Jabber/XMPP client."
arch=('x86_64')
url="http://www.vacuum-im.org/"
license=('GPL3')
conflicts=('vacuum' 'vacuum-snv')
provides=('vacuum')
replaces=('vacuum' 'vacuum-svn')
depends=('qt5-base>=5.9.0' 'libidn' 'openssl' 'zlib')
makedepends=('git')

_gitroot=https://github.com/Vacuum-IM/vacuum-im.git
_gitname=vacuum-im

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."
 
  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
    cd "$_gitname"
    git checkout 1.3.0.20180105-Alpha
  fi
  
  qmake-qt5 INSTALL_PREFIX=/usr CONFIG-=debug_and_release CONFIG-=debug -recursive vacuum.pro
  make -j$(nproc)
}

package() {
  cd $_gitname
  make INSTALL_ROOT="${pkgdir}" install
}